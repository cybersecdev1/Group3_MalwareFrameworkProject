# Group3 - setup.py
# The code was taken and modified from the setup section of the following:  https://ecederstrand.github.io/exchangelib/#installation

import urllib3
from urllib.parse import urlparse
import requests.adapters
from exchangelib import DELEGATE, IMPERSONATION, Account, Credentials, Configuration, CBA, TLSClientAuth, Message
from exchangelib.protocol import BaseProtocol, NoVerifyHTTPAdapter

# Disables certificate error
urllib3.disable_warnings()

# Changing the certificate requirement
BaseProtocol.HTTP_ADAPTER_CLS = NoVerifyHTTPAdapter

# Credential of the user
user_one_cred = Credentials(username='groupthree\\userone', password='Passw0rd!')
user_two_cred = Credentials(username='groupthree\\usertwo', password='Passw0rd!')


# Email server configuration
user_one_config = Configuration(server='mail.groupthree.local', credentials=user_one_cred)
user_two_config = Configuration(server='mail.groupthree.local', credentials=user_one_cred)

# Creating account object and connection
user_one_account = Account(	primary_smtp_address='userone@groupthree.local', credentials=user_one_cred, autodiscover=False, config=user_one_config, access_type=DELEGATE)
user_two_account = Account(	primary_smtp_address='usertwo@groupthree.local', credentials=user_two_cred, autodiscover=False, config=user_two_config, access_type=DELEGATE)

for mail in user_one_account.inbox.all():
	print(mail.subject)

