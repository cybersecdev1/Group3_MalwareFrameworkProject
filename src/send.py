from exchangelib import Account, Message, Mailbox, FileAttachment, HTMLBody, DELEGATE, Credentials, Configuration, ItemAttachment
from exchangelib.protocol import BaseProtocol, NoVerifyHTTPAdapter
import urllib3

user_name=input("Enter user account name: ")
receiver_name=input("Enter receiver name: ")
urllib3.disable_warnings()
BaseProtocol.HTTP_ADAPTER_CLS = NoVerifyHTTPAdapter
cred = Credentials(username='groupthree\\{}'.format(user_name), password='Passw0rd!')
config = Configuration(server='mail.groupthree.local', credentials=cred)
user_account = Account(primary_smtp_address='{}@groupthree.local'.format(user_name), credentials=cred, autodiscover=False, config=config, access_type=DELEGATE)


file_name="clean_attachment.txt"
file = open(file_name, "r")
attachment_file = FileAttachment(name=file_name, content=file.read().encode('utf-8'))

message = Message(
		account=user_account,
		folder=user_account.sent,
		subject='Testing Python Script',
		body='This is the body of the email',
		to_recipients=[Mailbox(email_address='{}@groupthree.local'.format(receiver_name))]
)
message.attach(attachment_file)
message.send_and_save()
print(f'Email sent to {receiver_name} successfully!')
