import urllib3
from datetime import datetime
from exchangelib import Account, Message, Mailbox, FileAttachment, HTMLBody, DELEGATE, Credentials, Configuration, ItemAttachment
from exchangelib.protocol import BaseProtocol, NoVerifyHTTPAdapter

user_name=input("Enter user account name: ")
receiver_name=input("Enter receiver name: ")
urllib3.disable_warnings()
BaseProtocol.HTTP_ADAPTER_CLS = NoVerifyHTTPAdapter
cred = Credentials(username='groupthree\\{}'.format(user_name), password='Passw0rd!')
config = Configuration(server='mail.groupthree.local', credentials=cred)
user_account = Account(primary_smtp_address='{}@groupthree.local'.format(user_name), credentials=cred, autodiscover=False, config=config, access_type=DELEGATE)


file_name="clean_attachment.txt"
word_file="dummy_clean_word.docx"

file = open(file_name, "r")
word = open(word_file, "rb")

text_file = FileAttachment(name=file_name, content=file.read().encode('utf-8'))
word_file = FileAttachment(name=word_file, content=word.read())

message = Message(
		account=user_account,
		folder=user_account.sent,
		subject=f'Testing Python Script {datetime.now()}',
		body='This is the body of the email',
		to_recipients=[Mailbox(email_address='{}@groupthree.local'.format(receiver_name))]
)
message.attach(text_file)
message.attach(word_file)
message.send_and_save()
print(f'Email sent to {receiver_name} successfully!')