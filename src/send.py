import urllib3
from datetime import datetime
from exchangelib import Account, Message, Mailbox, FileAttachment, HTMLBody, DELEGATE, Credentials, Configuration, ItemAttachment
from exchangelib.protocol import BaseProtocol, NoVerifyHTTPAdapter

def send_email(user_name=None, receiver_name=None):
	if user_name == None:
		user_name=input("Enter user account name: ")
	if receiver_name == None:
		receiver_name=input("Enter receiver name: ")
	urllib3.disable_warnings()
	BaseProtocol.HTTP_ADAPTER_CLS = NoVerifyHTTPAdapter
	if 'user' in user_name:
		password = 'Junk@6204'
	else:
		password = 'Passw0rd!'
	cred = Credentials(username='groupthree\\{}'.format(user_name), password=password)
	config = Configuration(server='mail.groupthree.local', credentials=cred)
	user_account = Account(primary_smtp_address='{}@groupthree.local'.format(user_name), credentials=cred, autodiscover=False, config=config, access_type=DELEGATE)


	file_name="clean_attachment.txt"
	word_name="dummy_clean_doc_file.doc"
	excel_name="dummy_clean_xls_file.xls"
	vba_word_name="dummy_doc_vba.doc"

	file = open(file_name, "r")
	word = open(word_name, "rb")
	excel = open(excel_name, "rb")
	vba_word = open(vba_word_name, 'rb')

	#text_file = FileAttachment(name=file_name, content=file.read().encode('utf-8'))
	#word_file = FileAttachment(name=word_name, content=word.read())
	#excel_file = FileAttachment(name=excel_name, content=excel.read())
	vba_file = FileAttachment(name=vba_word_name, content=vba_word.read())

	message = Message(
			account=user_account,
			folder=user_account.sent,
			subject=f'Testing Python Script {datetime.now()}',
			body='This is the body of the email',
			to_recipients=[Mailbox(email_address='{}@groupthree.local'.format(receiver_name))]
	)
	#message.attach(text_file)
	#message.attach(word_file)
	#message.attach(excel_file)
	message.attach(vba_file)
	message.send_and_save()
	print(f'Email sent to {receiver_name} successfully!')